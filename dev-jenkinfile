@Library('jenkins_shared_lib') _

pipeline{
    agent any
   parameters{
        choice(name: 'action', choices: 'create\ndelete', description: 'Choose create/Destroy')
        string(name: 'aws_account_id', description: " AWS Account ID", defaultValue: '966120781179')
    }
    environment{
        ACCESS_KEY = credentials('AWS_ACCESS_KEY_ID')
        SECRET_KEY = credentials('AWS_SECRET_KEY_ID')
        }

    stages {

        stage("git checkout"){
           
           steps{

            checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/DevidasSP/projectfile.git']])
            }
        
        }
  
     stage("Unit Test Maven"){
                when { expression {  params.action == 'create' } }
            steps{
               script{  
                   mvnTest()
               }
            }       
        }
        stage("Integration Test maven"){
            when { expression {  params.action == 'create' } }
            steps{
               script{  
                   mvnIntegrationTest()
               }
            }       
        }
        stage("Static code analysis: sonarqube-api"){
            when { expression {  params.action == 'create' } }
            steps{
               script{  
                   def SonarQubecredentialsId = 'sonarqube-api'
                   statiCodeAnalysis(SonarQubecredentialsId)
               }
            }       
        }
}
}